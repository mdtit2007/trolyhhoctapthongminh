@model IEnumerable<ungdunghocthongminh.Models.EF.Schedule>
@{
    ViewBag.Title = "Nhắc Nhở Học Tập";
    var remindersJson = Model != null
        ? System.Web.Helpers.Json.Encode(Model.Select(r => new
        {
            r.Title,
            Start = r.Start.ToString("yyyy-MM-dd"),
            r.Reminder
        }))
        : "[]";
}

<div class="container mt-5">
    <div class="text-center mb-4">
        <h2 class="display-6 fw-bold">Nhắc Nhở Học Tập</h2>
        <p class="text-muted">Danh sách các nhắc nhở quan trọng của bạn</p>
    </div>

    <div class="row justify-content-center">
        @if (Model != null && Model.Any())
        {
            foreach (var reminder in Model)
            {
                <div class="col-md-6 mb-3">
                    <div class="card border-light shadow-sm">
                        <div class="card-body">
                            <p class="card-text">
                                📢 <span class="fw-bold">@reminder.Reminder</span>
                            </p>
                            <p class="card-text">
                                <span class="">@reminder.Title</span>
                            </p>
                            <p class="card-text">
                                <span>Tiết: @reminder.Tiet</span>
                            </p>
                            <p class="card-text">
                                <span>Thời gian: @reminder.Start.ToString("dd/MM/yyyy") - @reminder.End.ToString("dd/MM/yyyy")</span>
                            </p>
                            <p class="card-text">
                                <span>Lớp: @reminder.className</span>
                            </p>
                            <p class="card-text">
                                <span>GV: @reminder.TeacherName</span>
                            </p>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12 text-center">
                <p class="text-muted">Hiện tại không có nhắc nhở nào.</p>
            </div>
        }
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Lấy danh sách nhắc nhở từ Razor
        var reminders = @Html.Raw(remindersJson);

        if (reminders && reminders.length > 0) {
            // Lấy ngày hôm nay và ngày mai
            var today = new Date();
            today.setHours(0, 0, 0, 0);

            var tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);

            // Duyệt qua các nhắc nhở
            reminders.forEach(function (reminder) {
                var startDate = new Date(reminder.Start);
                if (startDate.getTime() === tomorrow.getTime()) {
                    // Hiển thị thông báo nếu ngày bắt đầu là ngày mai
                    alert("📢 Nhắc nhở: " + reminder.Reminder + " - Tiêu đề: " + reminder.Title);
                }
            });
        }
    });
</script>
